___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Jobcase, Inc. Partner Action Tracking Tag",
  "categories": [
    "ATTRIBUTION"
  ],
  "brand": {
    "id": "Jobcase",
    "displayName": "Jobcase, Inc.",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Jobcase, Inc. Partner Action Tracking Tag is use to provide attribution based on an action taken by the user on a partner site.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "tagType",
    "displayName": "Tag Type",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "lp",
        "displayValue": "Landing Page"
      },
      {
        "value": "conv",
        "displayValue": "Conversion"
      }
    ],
    "simpleValueType": true,
    "help": "When the tag type is set to \u003cstrong\u003eLanding Page\u003c/strong\u003e, it will extract the \u003cstrong\u003etracking\u003c/strong\u003e parameter values from the URL and store it in a cookie named \u003cstrong\u003ejc_akey, jc_ikey \u0026 jc_akey_ref\u003c/strong\u003e. When the tag type to \u003cstrong\u003eConversion\u003c/strong\u003e, the tag will fire the conversion pixel to Jobcase.",
    "alwaysInSummary": false,
    "defaultValue": "lp"
  },
  {
    "type": "TEXT",
    "name": "customAction",
    "displayName": "Custom Action Name",
    "simpleValueType": true,
    "help": "custom action name ex: Apply, Registration",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "conv",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const getCookie = require('getCookieValues');
const setCookie = require('setCookie');
const sendPixel = require('sendPixel');
const getQueryParameters = require('getQueryParameters');
const encode = require('encodeUriComponent');
const Math = require('Math');
const log = require('logToConsole');
const getTimestampMillis = require('getTimestampMillis');
const jbcb_time = Math.round(getTimestampMillis() / 1000);

if (data.tagType === 'lp') {
  const akey = getQueryParameters('akey');
  const ikey = getQueryParameters('ikey');
  log('url param ikey =', ikey);
  if(akey !== null && ikey !== null) {
    let akey_ref = getQueryParameters('akey_ref');
    if(akey_ref === undefined) akey_ref = 'www.jobcase.com';
    const jc_ikey = getCookie('jc_ikey');
    log('cookie jc_ikey =', jc_ikey);
    log('param akey_ref =', akey_ref);
    if(jc_ikey.length == 0 || jc_ikey[0] != ikey) {
      log('setting cookie');
      setCookie('jc_akey', akey, {domain: 'auto', path: '/', 'max-age': 60*60*24*30, secure: true});
      setCookie('jc_ikey', ikey, {domain: 'auto', path: '/', 'max-age': 60*60*24*30, secure: true});
      setCookie('jc_akey_ref', akey_ref, {domain: 'auto', path: '/', 'max-age': 60*60*24*30, secure: true});
    }
  }
  // Call data.gtmOnSuccess when the tag is finished.
  data.gtmOnSuccess();
} else if (data.tagType === 'conv') {
  const jc_akey = getCookie('jc_akey');
  log('cookie jc_akey =', jc_akey);
  const jc_ikey = getCookie('jc_ikey');
  const jc_akey_ref = getCookie('jc_akey_ref');
  if(jc_akey.length && jc_ikey.length && jc_akey_ref.length) {
    let pixel_url = 'https://' + jc_akey_ref[0] + '/sp1eh5/jbc_done.gif?akey=' + encode(jc_akey[0]);
    pixel_url += '&ikey=' + encode(jc_ikey[0]) + '&jbcb=' + jbcb_time + '&action_name=' + encode(data.customAction);
    log('url =', pixel_url);
    sendPixel(pixel_url, data.gtmOnSuccess, data.gtmOnFailure);
  }
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "jc_akey"
              },
              {
                "type": 1,
                "string": "jc_ikey"
              },
              {
                "type": 1,
                "string": "jc_akey_ref"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jc_akey"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "non_session"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jc_ikey"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "non_session"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jc_akey_ref"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "non_session"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryKeys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "akey"
              },
              {
                "type": 1,
                "string": "ikey"
              },
              {
                "type": 1,
                "string": "akey_ref"
              }
            ]
          }
        },
        {
          "key": "query",
          "value": {
            "type": 8,
            "boolean": true
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Do not set cookies if missing tracking parameters
  code: |-
    mock('getQueryParameters', key => {
      if (key === 'akey' || key === 'ikey' || key === 'akey_ref') return;
      else fail('getQueryParameters() called with invalid parameter name: ' + key);
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Save Tracking Params in cookies
  code: |-
    mock('getQueryParameters', key => {
      if (key === 'akey') return 'akey';
      if (key === 'ikey') return 'ikey1';
      if (key === 'akey_ref') return 'www.jobcase.com';
      else fail('getQueryParameters() called with invalid parameter name: ' + key);
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('setCookie').wasCalledWith('jc_akey', 'akey', mockCookieOptions);
    assertApi('setCookie').wasCalledWith('jc_ikey', 'ikey1', mockCookieOptions);
    assertApi('setCookie').wasCalledWith('jc_akey_ref', 'www.jobcase.com', mockCookieOptions);
    assertApi('gtmOnSuccess').wasCalled();
- name: SendPixel when cookies exists
  code: "mockData.tagType = 'conv';\nlet success, failure;\n\nmock('getTimestampMillis',\
    \ () => {\n  return 1600297086000;\n});\n\nmock('getCookie', key => {\n  if (key\
    \ === 'jc_akey') return ['akey'];\n  if (key === 'jc_ikey') return ['ikey'];\n\
    \  if (key === 'jc_akey_ref') return ['www.jobcase.com'];\n  else fail('getCookie()\
    \ called with invalid cookie name: ' + key);\n});\n\nmock('sendPixel', (url, onsuccess,\
    \ onfailure) => {\n  success = onsuccess;\n  failure = onfailure;\n  onsuccess();\n\
    });\n\nlet mockUrl = 'https://www.jobcase.com/sp1eh5/jbc_done.gif?akey=akey&ikey=ikey&jbcb=1600297086&action_name=Registration';\n\
    \  \n// Call runCode to run the template's code.\nrunCode(mockData);\n\n// Verify\
    \ that the tag finished successfully.\nassertApi('getTimestampMillis').wasCalled();\n\
    assertApi('sendPixel').wasCalledWith(mockUrl, success, failure);\nassertApi('gtmOnSuccess').wasCalled();"
setup: |-
  const mockData = {
    tagType: 'lp',
    customAction: 'Registration',
  };

  const mockCookieOptions = {domain: 'auto', path: '/', 'max-age': 60*60*24*30, secure: true};


___NOTES___

Created on 9/21/2020, 10:20:15 AM


